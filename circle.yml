general:
  artifacts:
    - "target"

machine:
  pre:
    - make -f docker-squash/Makefile ci-install-docker
  python:
  services:
    - docker
  environment:
    CI: true

dependencies:
  pre:
    - mkdir -p ~/.pyenv
    - make -f Makefile ci-install-pythons
  cache_directories:
    - ~/.pyenv
  override:
    - pip install tox tox-pyenv docker-py>=1.7.2 six
    - pyenv local 2.7.14 3.4.8 3.5.5 3.6.5
  post:
    - docker version
    - docker info

test:
  override:
    - case $CIRCLE_NODE_INDEX in 0) make test-py27 ;; 1) make test-py34 ;; 2) make test-py35 ;; esac:
        parallel: true
    - make test-py36:
        parallel: true
    - make test-py36:
        parallel: true
  post:
    - make ci-publish-junit
